<!DOCTYPE html>
<html>
  <head>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap-theme.min.css" integrity="sha384-6pzBo3FDv/PJ8r2KRkGHifhEocL+1X2rVCTTkUfGk7/0pbek5mMa1upzvWbrUbOZ" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
  </head>
  <body>

    <p align="right">
      <a href="" ><input type="button" class="btn btn-primary mb-2" value="refresh"></input></a>
    </p>
    <div align="left"> PORT#: <%= port %></div>
    <!--<form class="form-inline" action="/create-queue-index" method="POST" >
      <div class="form-group mx-sm-3 mb-2">
        <input type="text" class="form-control" id="qname" name="qname" placeholder="Queue name" autocomplete="off">
      </div>
      <button type="submit" class="btn btn-primary mb-2">Create a new Queue</button>
    </form>
    -->
    <form class="form-inline" action="/add-to-queue-index" method="POST" >
      <div class="form-group mx-sm-3 mb-2">
        <input type="text" class="form-control" id="qname" name="qname" placeholder="Queue name" autocomplete="off">
        <input type="text" class="form-control" id="qmessage" name="qmessage" placeholder="Queue message" autocomplete="off">
      </div>
      <button type="submit" class="btn btn-primary mb-2">Add a message to the queue</button>
    </form>
    <form class="form-inline" action="/pull-from-queue-index" method="POST">
      <div class="form-group mx-sm-3 mb-2">
        <input type="text" class="form-control" id="qname2" name="qname2" placeholder="Queue name" autocomplete="off">
      </div>
      <button type="submit" class="btn btn-primary mb-2">pull from queue</button>
    </form>


    <div id="div_table">
    <table class="table table-striped table-bordered table-dark table-hover">
      <thead class="thead-dark">
        <tr>
          <th scope="col">#</th><!--# -->
          <th scope="col">Queue</th>
          <th scope="col">Messages</th>
        </tr>
      </thead>
      <tbody>
        <% var cnt = 0 %>
        <% queues.forEach(queue =>{ %>
        <%  cnt = cnt + 1; %>
          <tr>
            <th scope="row"><%= cnt %></th>
            <td><%= queue.name() %></td>
            <td><a href="" onclick="javascript:modalPopUp(<%= cnt %>);return false;"><%= queue.depth() %></a>
                <div id="<%= cnt %>" class="modal">
                  <div class="modal-content">
                    <span class="close"><a href="" onclick="">&times;</a></span>
                    <div class="table-wrapper-scroll-y my-custom-scrollbar">
                      <table class="table table-striped table-bordered table-dark table-hover table-responsive" height="50px">
                          <thead>
                            <th>#</th>
                            <th>timestamp</th>
                            <th>message</th>
                          </thead>
                          <tbody>
                            <% var msgcnt = 0; %>
                            <% var bucket = queue.bucket();%>
                            <% bucket.forEach(message => { %>
                            <% msgcnt = msgcnt + 1; %>
                            <tr>
                              <td><%= msgcnt  %> </td>
                              <td><%= message.timestamp %></td>
                              <td><%= message.msg %></td>
                            </tr>
                            <% }); %>
                          </tbody>
                      </table>
                    </div>
                  </div>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
    </div>
    <%= JSON.stringify(pull) %>
    <script>
      
      var modal = null;

      function modalPopUp(id) {
        this.id = id;
        this.modal = document.getElementById(id);
        modal.style.display = "block";
      }

      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }

    </script>
  </body>
</html>
