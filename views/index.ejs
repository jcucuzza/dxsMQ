<!DOCTYPE html>
<html>
  <head>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap-theme.min.css" integrity="sha384-6pzBo3FDv/PJ8r2KRkGHifhEocL+1X2rVCTTkUfGk7/0pbek5mMa1upzvWbrUbOZ" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="div_table">
    <table class="table table-striped table-bordered table-dark table-hover">
      <thead class="thead-dark">
        <tr>
          <th scope="col">#</th><!--# -->
          <th scope="col">Queue</th>
          <th scope="col">Messages</th>
        </tr>
      </thead>
      <tbody>
        <% var cnt = 0 %>
        <% queues.forEach(queue =>{ %>
        <%  cnt = cnt + 1; %>
          <tr>
            <th scope="row"><%= cnt %></th>
            <td><%= queue.name() %></td>
            <td><a href="" onclick="javascript:modalPopUp(<%= cnt %>);return false;"><%= queue.depth() %></a>
                <div id="<%= cnt %>" class="modal">
                  <div class="modal-content">
                    <span class="close">&times;</span>
                    <div class="table-wrapper-scroll-y my-custom-scrollbar">
                      <table class="table table-striped table-bordered table-dark table-hover table-responsive" height="50px">
                          <thead>
                            <th>#</th>
                            <th>message</th>
                            <th>timestamp</th>
                          </thead>
                          <tbody>
                            <% var msgcnt = 0; %>
                            <% var bucket = queue.bucket();%>
                            <% bucket.forEach(message => { %>
                            <% msgcnt = msgcnt + 1; %>
                            <tr>
                              <td><%= msgcnt  %> </td>
                              <td><%= message %></td>
                              <td></td>
                            </tr>
                            <% }); %>
                          </tbody>
                      </table>
                    </div>
                  </div>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
    </div>

    <script>
      var modal = null;
      var span = document.getElementsByClassName("close")[0];
      
      function modalPopUp(id) {
        this.modal = document.getElementById(id);
        modal.style.display = "block";
      }

      span.onclick = function() {
        modal.style.display = "none";
      }

      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }
    </script>
  </body>
</html>
